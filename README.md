#bitrix_theme_mfc


###Шаблон дизайна сайта

Шаблон сайта определяет:

>* оформление сайта (дизайн, верстку страниц, набор основных каскадных стилей);
>* типы меню и их расположение;
>* наличие рекламных областей (областей для размещения баннеров);
>* наличие включаемых областей в шаблоне и страницах сайта;
>* наличие в дизайне сайта формы авторизации, оформления подписки и т.д.

Шаблон дизайна сайта обычно состоит из трех основных частей:

>* Верхней части дизайна (header);
>* Рабочей области страницы (Work area);
>* Нижней части дизайна (footer).

**Header** - верхняя часть дизайна, заголовок. Включает в себя, как правило, верхнюю и левую часть дизайна со статической информацией (логотипом, лозунгом и так далее), верхним горизонтальным меню и левым меню (если они есть в дизайне). Может включать в себя информационные динамические материалы. Хранится в отдельном файле .../<идентификатор_шаблона>/header.php.

**Work area** - рабочая область страницы, в которой размещаются собственно информационные материалы сайта. Рабочая область - это все создаваемые пользователями документы, хранящиеся в файлах <имя_документа>.php в соответствующих папках сайта.

**Footer** - нижняя часть дизайна со статической информацией (как правило: контактная информация, сведения об авторе и владельце сайта и так далее), нижним горизонтальным меню и правым меню (если они есть в дизайне). Может включать в себя информационные материалы. Хранится в отдельном файле .../<идентификатор_шаблона>/footer.php.

####Композиция шаблона

Композиция шаблона сайта может быть любой, главное: не нарушить порядок следования составных частей. 
Статическая информация, которая не нуждается (либо редко нуждается) в замене, как правило, размещается в статических зонах Footer и Header. Заменить ее можно в кодах самих файлов, но делать это придется квалифицированному разработчику, либо разработчик должен организовать такую замену с помощью компонентов системы силами редакторов сайта.

####Подключение частей дизайна

Сборка типовых страниц сайта выполняется путем подключения верхней и нижней частей дизайна для каждой страницы сайта. В общем случае структура страницы сайта выглядит так:

```php
<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
$APPLICATION->SetTitle("1C-Битрикс: Управление сайтом");
?>
Тело документа. Содержательная часть.
<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");
?>
```

**Примечание**: Помимо статической информации, в шаблоне и в рабочей области могут располагаться:
Визуальные компоненты
Включаемые области
Произвольный PHP-код
Эти элементы сайта предназначены для вывода динамической информации.

####Структура файлов шаблона сайта

Настройка условий применения того или иного шаблона определяется отдельно для каждого сайта (в форме создания и редактирования сайта: Настройки > Настройки продукта > Сайты > Список сайтов).

Набор файлов в каталоге /bitrix/templates/ID шаблона сайта/, где ID шаблона сайта - поле ID в форме редактирования шаблона сайта. Ниже представлена структура данного каталога:
>* файл header.php - часть шаблона ДО контента;
>* файл footer.php - часть шаблона ПОСЛЕ контента;
>* файл description.php – название и описание шаблона;
>* файл styles.css - стили для контента и включаемых областей. Эти стили можно применять в визуальном редакторе;
>* /components/ - каталог с шаблонами компонентов, принадлежащими тому или иному модулю;
>* /lang/ - языковые файлы, принадлежащие как данному шаблону в целом, так и отдельным компонентам;
>* /images/ - каталог с изображениями данного шаблона сайта;
>* /page_templates/ - каталог с шаблонами страниц и их описанием, хранящимся в файле .content.php. Когда пользователь создает новую страницу, он может выбрать, по какому шаблону он это сделает.
>* /include_areas/ - каталог с файлами - содержимым включаемых областей. Произвольная (т.е. название не регламентировано) папка для файлов включаемых областей компонента (main.include). Обычно вызов компонента делают из шаблона сайта. Файлы включаемых областей группируют в эту папку для удобства, т.к. они могут иметь оформление, специфичное для конкретного шаблона сайта. Там могут быть название, лого, контактная информация - чтобы пользователь редактировал только эти данные, не затрагивая шаблон сайта.
>* а также ряд других вспомогательных произвольных файлов и папок, входящих в данный шаблон.


![](https://opt-560835.ssl.1c-bitrix-cdn.ru/images/dev_full/integration/templates/scheme2.png?1333364343122109)

**Примечание**: При создании шаблона сайта возможно использование различных программных условий, влияющих на отображение тех или иных элементов шаблона для различных разделов сайта. В этом случае для раздела сайта нужно определить некоторое свойство, значение которого будет проверяться в шаблоне сайта:

```php
<?if ($APPLICATION->GetProperty(“SECT_PROP”)=="Y"):?>
```

####Рекомендации по созданию шаблона
Основные моменты, которые нужно учитывать при создании шаблона:

>* При подготовке графического дизайна следует заранее разметить линию раздела дизайна на пролог (header.php) и эпилог (footer.php).
>* Следует выделить основные элементы дизайна, для последующей модификации таблицы стилей: шрифты, цвета заливки и т.п.
>* Разрабатывая дизайн меню различных уровней, желательно выделять повторяющиеся элементы - для упрощения создания шаблона меню и дальнейшего управления этими меню.
>* Для облегчения сопровождения различных языковых версий сайта по возможности следует использовать вместо графических элементов текстовые.
>* При нарезке графического дизайна и подготовке HTML шаблона, необходимо заранее предусмотреть место расположения основных компонентов системы управления сайтом. Выделить области меню, рекламные области, области размещения дополнительных форм. Рекомендуется верстать компоненты независимо от основного шаблона. Чтобы в будущем, при перемещении компонента в другое место или другой шаблон, не поехала верстка.
>* Для удобства отладки верстки, рекомендуется отключить сжатие и объединение css и js файлов.
>* Размещать графические изображения, относящиеся к шаблону сайта, следует в папке /bitrix/templates/<имя_шаблона>/images.
>* Каскадные стили, используемые в шаблоне, рекомендуется разделять на две таблицы стилей, хранящиеся в двух разных файлах. Оба файла находятся в директории /bitrix/templates/<идентификатор_шаблона>/. Файл styles.css содержит стили для представления информационного содержания страницы на сайте. Файл template_styles.css содержит стили для отображения текстов в самом шаблоне дизайна.

>При необходимости можно подключить в <head> любое количество стилевых файлов, дополнительно к styles.css и template_styles.css, подключаемым через showhead(). Делается это обычными линками перед закрытием тэга </head>, а дополнительные стилевые файлы положите в любую папку. Эффект будет тот же самый, как если бы вы собрали все ваши дополнительные стили и дописали их в два файла шаблона сайта со стандартными наименованиями.

####Шаблон сайта

Шаблоны сайта переключаются в "Настройки" > "Настройки продукта" > "Сайты" > "Список сайтов" > Выбор сайта, внизу страницы со свойствами будет таблица "Шаблон сайта".
Количество используемых на сайте шаблонов дизайна не ограничено. Для каждого шаблона определяется условие, при котором данный шаблон будет применяться к страницам сайта:

![](https://opt-560835.ssl.1c-bitrix-cdn.ru/images/admin_start/admin_base/control_elements/templates_11.png?140663808994927)

Количество используемых на сайте шаблонов дизайна не ограничено. Для каждого шаблона определяется условие, при котором данный шаблон будет применяться к страницам сайта. Тип условия можно выбрать одно из следующих значений:
* **Без условия** - выбранный шаблон будет применен к каждой странице сайта, к которой не указано условия.
* **Для папки и файла** - выбранный шаблон будет применен только к указанной папке (разделу) или файлу (странице). При выборе этого условия в колонке Условие появится поле для указания папки или файла. Папку или файл можно указать вручную, либо с помощью кнопки [...].
* **Для групп пользователей** - страница в выбранном шаблоне будет отображаться только тем пользователям, которые относятся к указанным группам. В колонке Условия отобразится список всех групп, имеющихся в системе. Можно выбрать одну или несколько групп.
* **Период времени** - страница будет отображаться в выбранном шаблоне в указанный период времени.
* **Параметр в URL** - страница в выбранном шаблоне будет отображаться только в случае если в ее адресе стоит определенный параметр.
* **Выражение PHP** - шаблон применяется к странице, которая будет выбрана в соответствии с заданным выражением PHP.

**Внимание!** При настройке условий применения шаблонов обязательно указывайте индекс сортировки. Порядок применения шаблонов к сайту определяется в соответствии с указанной сортировкой. Если для страницы (раздела) может быть применено несколько шаблонов, то в итоге будет применен шаблон с большей сортировкой. Если индекс сортировки задан не будет, то может быть применен неверный шаблон.
Общее правило сортировки при назначении шаблонов подобно перевернутой воронке:
* первыми должны идти условия частного характера;
* потом условия выборки;
* потом все остальное.

Стили шаблона сайта подключаются последними - это крайняя возможность переопределить, например, стили стандартных компонентов. Иначе потребуется масштабная кастомизация шаблонов компонентов. Если есть необходимость подключить свои стили последними, то это можно сделать с помощью функции CMain::AddHeadString.

###Создание и установка шаблона

Есть несколько вариантов установки шаблона: 
>* Загрузка готового шаблона из Marketplace
>* Загрузка архива шаблона (*.gz): "Настройки" > "Настройки продукта" > "Сайты" > "Шаблоны сайтов" > "Загрузить шаблон"
>* Добавление нового шаблона: "Настройки" > "Настройки продукта" > "Сайты" > "Шаблоны сайтов" > "Добавить шаблон"

Любой из шаблонов из списка "Шаблоны сайта" можно скачать. Также можно скопировать исходный шаблон и внести в него правки.

####Форма создания шаблона
Перейдите в раздел Настройки > Настройки продукта > Сайты > Шаблоны сайтов. В Рабочей области откроется форма Шаблоны сайтов.
Выполните команду Добавить шаблон на Контекстной панели. Откроется форма создания нового шаблона. В этой форме в поле:
* ID - введите название шаблона. В нашем примере это будет test.
*  Название - введите название шаблона. (Может быть и на кириллице и на латинице), например, тоже test.
* Описание - можно вставить ваш комментарий к шаблону.
* Порядок - значение определяет порядок отображения шаблона в общем списке шаблонов.
* Использовать визуальный редактор - установите флажок, если планируете редактировать шаблон через визредактор. По умолчанию в дистрибутиве эта возможность отключена. (Использование визуального редактора для редактирования шаблона полностью отключено с версии 14.0.)

**Примечание:** Без установки в шаблоне разделителя #WORK_AREA# сохранение шаблона невозможно. Поэтому у нас сейчас последует этап работы, который вы не сможете прервать в произвольный момент.

###Ссылки на подробные инструкции по верстке и интеграции шаблона
Верстка базового шаблона
<https://dev.1c-bitrix.ru/learning/course/?COURSE_ID=43&LESSON_ID=2880&LESSON_PATH=3913.4775.2880>

Интеграция дизайна
https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=04564&LESSON_PATH=3913.4564

Подробный разбор шаблона меню
http://alexvaleev.ru/bitrix-menu/

###Пример смены шаблона сайта через cookie

В примере реализовано переключение сайта на версию для слабовидящих и обратно.
В главном меню основного шаблона добавить пункт меню 

```html
<a href="#" onclick="document.cookie='cookie_template=special';location.reload();" title="#">Версия для слабовидящих</a>
```

В свойствах сайта для шаблона слабовидящим установить условие по PHP выражению:
```php
$_COOKIE['cookie_template']=='special' 
```

Так мы перейдем из основного шаблона в специальный, для обратного перехода надо изменить ссылку в настройках специального шаблона:

```html
<a href="#" onclick="document.cookie='cookie_template=';location.reload();" title="#">Вернуться к обычной версии сайта</a>
```